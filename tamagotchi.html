<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Tamagotchi Avatar 1:1</title>

  <style>
    body {
      margin: 0;
      background: #ffffff;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: system-ui, sans-serif;
    }

    /* TODO 1:1 (150x150) */
    .tamagotchi {
      position: relative;
      width: 150px;
      height: 150px;
    }

    .frame {
      position: relative;
      inset: 0;
      width: 150px;
      height: 150px;
      image-rendering: pixelated;
      user-select: none;
      -webkit-user-drag: none;
      pointer-events: none;
    }

    /* PANTALLA dentro del PNG (ajusta estos 4 valores 1 sola vez) */
    .screen {
      position: absolute;
      left: 38px;   /* <-- AJUSTA */
      top: 38px;    /* <-- AJUSTA */
      width: 74px;  /* <-- AJUSTA */
      height: 74px; /* <-- AJUSTA */
      overflow: hidden;
      pointer-events: none;
    }

    /* Capas del avatar 1:1 */
    .avatar-layer {
      position: absolute;
      inset: 0;
      width: 150px;
      height: 150px;
      image-rendering: pixelated;
      pointer-events: none;
      left: -38px;   /* mueve a la izquierda (negativo = va a la izquierda) */
      top:  -38px;   /* mueve hacia arriba  (negativo = va hacia arriba) */

      /* 1:1 real: SIN SCALE */
      transform: none;
    }

    /* Si quieres “zoom”, cámbialo aquí después (pero por defecto 1:1) */
    /* .avatar-layer { transform: scale(2); transform-origin: center; } */

    /* Botones clickeables (invisibles visualmente, con tu PNG encima) */
    .tama-btn {
      position: absolute;
      width: 28px;
      height: 28px;
      border: 0;
      background: transparent;
      padding: 0;
      cursor: pointer;
      display: grid;
      place-items: center;
    }

    .tama-btn img {
      width: 150px;
      height: 150px;
      display: block;
      image-rendering: pixelated;
      pointer-events: none;
      user-select: none;
      -webkit-user-drag: none;
      left: -38px;   /* mueve a la izquierda (negativo = va a la izquierda) */
      top:  -38px;   /* mueve hacia arriba  (negativo = va hacia arriba) */

      /* Mostrar tu botón 150x150 dentro de un área 28x28:
         en vez de escalarlo raro, recortamos con overflow.
         Pero como img no recorta, hacemos “scale” solo al botón PNG */
      transform: none;
    }

    /* efecto de presionar */
    .tama-btn:active {
      transform: translateY(1px) scale(0.96);
    }

    /* POSICIONES 1:1 (ajusta 1 vez para que calcen con tus 3 circulitos verdes) */
    .btn-1 { left: 38px; top: 118px; } /* Cara */
    .btn-2 { left: 61px; top: 122px; } /* Pelo */
    .btn-3 { left: 84px; top: 118px; } /* Skin/Raza */
  </style>
</head>

<body>
  <div class="tamagotchi">
    <!-- Frame 150x150 -->
    <img class="frame" src="img0/tamagotchi/Tamagotchi.png" alt="Tamagotchi" />

    <!-- Pantalla -->
    <div class="screen">
      <img id="skinLayer" class="avatar-layer" src="img0/skin/Skin1.png" alt="Skin" />
      <img id="hairLayer" class="avatar-layer" src="img0/hair/Hair1.png" alt="Hair" />
      <img id="faceLayer" class="avatar-layer" src="img0/face/Face1.png" alt="Face" />
    </div>

    <!-- Botones -->
    <button class="tama-btn btn-1" id="btnFace" aria-label="Cambiar cara">
      <img src="img0/buttons/Button1.png" alt="" />
    </button>

    <button class="tama-btn btn-2" id="btnHair" aria-label="Cambiar pelo">
      <img src="img0/buttons/Button2.png" alt="" />
    </button>

    <button class="tama-btn btn-3" id="btnSkin" aria-label="Cambiar skin">
      <img src="img0/buttons/Button3.png" alt="" />
    </button>
  </div>

  <script>
    const STORAGE_KEY = "tamagotchi_avatar_state_v1";

    const options = {
      skin: [
        "img0/skin/Skin1.png",
        "img0/skin/Skin2.png",
        "img0/skin/Skin3.png",
        "img0/skin/Skin4.png"
      ],
      hair: [
        "img0/hair/Hair1.png",
        "img0/hair/Hair2.png",
        "img0/hair/Hair3.png",
        "img0/hair/Hair4.png",
        "img0/hair/Hair5.png",
        "img0/hair/Hair6.png",
        "img0/hair/Hair7.png",
        "img0/hair/Hair8.png",
        "img0/hair/Hair9.png"
      ],
      face: [
        "img0/face/Face1.png",
        "img0/face/Face2.png",
        "img0/face/Face3.png",
        "img0/face/Face4.png"
      ]
    };

    let state = { skin: 0, hair: 0, face: 0 };

    function clampIndex(i, arr) {
      if (typeof i !== "number" || !Number.isFinite(i)) return 0;
      return Math.min(Math.max(i, 0), arr.length - 1);
    }

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const saved = JSON.parse(raw);
        state.skin = clampIndex(saved.skin, options.skin);
        state.hair = clampIndex(saved.hair, options.hair);
        state.face = clampIndex(saved.face, options.face);
      } catch (e) {}
    }

    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (e) {}
    }

    function render() {
      document.getElementById("skinLayer").src = options.skin[state.skin];
      document.getElementById("hairLayer").src = options.hair[state.hair];
      document.getElementById("faceLayer").src = options.face[state.face];
    }

    function next(part) {
      const arr = options[part];
      state[part] = (state[part] + 1) % arr.length;
      render();
      saveState();
    }

    loadState();
    render();

    document.getElementById("btnFace").addEventListener("click", () => next("face"));
    document.getElementById("btnHair").addEventListener("click", () => next("hair"));
    document.getElementById("btnSkin").addEventListener("click", () => next("skin"));
  </script>
</body>
</html>
